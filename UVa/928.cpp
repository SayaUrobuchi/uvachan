#include<stdio.h>
int a,b,c,d,e,f,g,h,i,j,m[270001][2],n[270001][2],p,q;
char k[302][302],l[301][301][3];
int main()
{
	scanf("%d",&h);
	for(h;h>0;h--)
	{
		scanf("%d%d",&a,&b);
		for(c=0;c<a;c++)
		{
			scanf("%s",&k[c]);
			for(d=0;d<b;d++)
			{
				l[c][d][0]=1;
				l[c][d][1]=1;
				l[c][d][2]=1;
				if(k[c][d]=='S')
				{
					i=c;
					j=d;
				}
			}
		}
		m[0][0]=i;
		m[0][1]=j;
		n[0][0]=1;
		n[0][1]=0;
		l[i][j][0]=0;
		for(c=0,d=1;c<d;c++)
		{
			i=m[c][0];
			j=m[c][1];
			e=n[c][0];
			if(i>e-1)
			{
				if(l[i-e][j][n[c][0]%3])
				{
					for(f=0,p=i-1,q=j;f<e;f++,p--)
					{
						if(k[p][q]=='#')
						{
							break;
						}
					}
					if(f==e)
					{
						p++;
						if(k[p][q]=='E')
						{
							g=n[c][1]+1;
							break;
						}
						m[d][0]=p;
						m[d][1]=q;
						n[d][0]=e+1;
						if(n[d][0]==4)
						{
							n[d][0]=1;
						}
						n[d++][1]=n[c][1]+1;
						l[p][q][n[c][0]%3]=0;
					}
				}
			}
			if(i<a-e)
			{
				if(l[i+e][j][n[c][0]%3])
				{
					for(f=0,p=i+1,q=j;f<e;f++,p++)
					{
						if(k[p][q]=='#')
						{
							break;
						}
					}
					if(f==e)
					{
						p--;
						if(k[p][q]=='E')
						{
							g=n[c][1]+1;
							break;
						}
						m[d][0]=p;
						m[d][1]=q;
						n[d][0]=e+1;
						if(n[d][0]==4)
						{
							n[d][0]=1;
						}
						n[d++][1]=n[c][1]+1;
						l[p][q][n[c][0]%3]=0;
					}
				}
			}
			if(j>e-1)
			{
				if(l[i][j-e][n[c][0]%3])
				{
					for(f=0,p=i,q=j-1;f<e;f++,q--)
					{
						if(k[p][q]=='#')
						{
							break;
						}
					}
					if(f==e)
					{
						q++;
						if(k[p][q]=='E')
						{
							g=n[c][1]+1;
							break;
						}
						m[d][0]=p;
						m[d][1]=q;
						n[d][0]=e+1;
						if(n[d][0]==4)
						{
							n[d][0]=1;
						}
						n[d++][1]=n[c][1]+1;
						l[p][q][n[c][0]%3]=0;
					}
				}
			}
			if(j<b-e)
			{
				if(l[i][j+e][n[c][0]%3])
				{
					for(f=0,p=i,q=j+1;f<e;f++,q++)
					{
						if(k[p][q]=='#')
						{
							break;
						}
					}
					if(f==e)
					{
						q--;
						if(k[p][q]=='E')
						{
							g=n[c][1]+1;
							break;
						}
						m[d][0]=p;
						m[d][1]=q;
						n[d][0]=e+1;
						if(n[d][0]==4)
						{
							n[d][0]=1;
						}
						n[d++][1]=n[c][1]+1;
						l[p][q][n[c][0]%3]=0;
					}
				}
			}
		}
		if(c==d)
		{
			printf("NO\n");
		}
		else
		{
			printf("%d\n",g);
		}
	}
	return 0;
}