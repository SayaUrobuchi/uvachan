#include<stdio.h>
#include<string.h>
int a,b,c,d,e,f,g,h,i,j;
char k[10][11],l[10][11],m[10][11];
int main()
{
	g=0;
	while(scanf("%d",&a)==1)
	{
		for(b=0;b<a;b++)
		{
			scanf("%s%s",k[b],l[b]);
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(k[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was preserved.\n",++g);
			continue;
		}
		for(b=0;b<a;b++)
		{
			for(c=0,d=a-1;d>-1;c++,d--)
			{
				m[b][d]=k[c][b];
			}
			m[b][c]=0;
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(m[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was rotated 90 degrees.\n",++g);
			continue;
		}
		for(b=0,c=a-1;c>-1;b++,c--)
		{
			for(d=0,e=a-1;e>-1;d++,e--)
			{
				m[b][d]=k[c][e];
			}
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(m[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was rotated 180 degrees.\n",++g);
			continue;
		}
		for(b=0;b<a;b++)
		{
			for(c=0,d=a-1;d>-1;c++,d--)
			{
				m[c][b]=k[b][d];
			}
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(m[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was rotated 270 degrees.\n",++g);
			continue;
		}
		for(b=0,c=a-1;c>-1;b++,c--)
		{
			for(d=0;d<a;d++)
			{
				m[b][d]=k[c][d];
			}
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(m[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was reflected vertically.\n",++g);
			continue;
		}
		for(b=0;b<a;b++)
		{
			strcpy(k[b],m[b]);
		}
		for(b=0;b<a;b++)
		{
			for(c=0,d=a-1;d>-1;c++,d--)
			{
				m[b][d]=k[c][b];
			}
			m[b][c]=0;
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(m[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was reflected vertically and rotated 90 degrees.\n",++g);
			continue;
		}
		for(b=0,c=a-1;c>-1;b++,c--)
		{
			for(d=0,e=a-1;e>-1;d++,e--)
			{
				m[b][d]=k[c][e];
			}
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(m[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was reflected vertically and rotated 180 degrees.\n",++g);
			continue;
		}
		for(b=0;b<a;b++)
		{
			for(c=0,d=a-1;d>-1;c++,d--)
			{
				m[c][b]=k[b][d];
			}
		}
		for(b=0;b<a;b++)
		{
			if(strcmp(m[b],l[b]))
			{
				break;
			}
		}
		if(b==a)
		{
			printf("Pattern %d was reflected vertically and rotated 270 degrees.\n",++g);
			continue;
		}
		printf("Pattern %d was improperly transformed.\n",++g);
	}
	return 0;
}