#include<stdio.h>
int a,b,c,d,e,f,g,h,i,j,l[32][32][4],m,n,r,s,y,z;
long long k[32][32];
char o;
int main()
{
	for(a=0;a<32;a++)
	{
		k[a][0]=0;
		k[0][a]=0;
	}
	scanf("%d",&h);
	for(h;h>0;h--)
	{
		scanf("%d%d%d%d%d%d",&a,&c,&d,&e,&f,&g);
		for(a++,b=1;b<a;b++)
		{
			for(i=1;i<a;i++)
			{
				k[b][i]=0;
				for(j=0;j<4;j++)
				{
					l[b][i][j]=1;
				}
			}
		}
		for(i=1,j=a+1;i<j;i++)
		{
			k[i][a]=0;
			k[a][i]=0;
		}
		k[e][f]=1;
		if(c<e)
		{
			i=1;
			y=0;
			m=c-1;
			n=e+1;
		}
		else
		{
			i=-1;
			y=1;
			m=e-1;
			n=c+1;
		}
		if(d<f)
		{
			j=1;
			z=2;
			r=d-1;
			s=f+1;
		}
		else
		{
			j=-1;
			z=3;
			r=f-1;
			s=d+1;
		}
		for(g;g>0;g--)
		{
			scanf("%d%d%s",&a,&b,&o);
			if(o=='N')
			{
				l[a][b][2]=0;
				l[a][b+1][3]=0;
			}
			else if(o=='W')
			{
				l[a][b][1]=0;
				l[a-1][b][0]=0;
			}
			else if(o=='S')
			{
				l[a][b][3]=0;
				l[a][b-1][2]=0;
			}
			else
			{
				l[a][b][0]=0;
				l[a+1][b][1]=0;
			}
		}
		for(a=e;a>m&&a<n;a-=i)
		{
			for(b=f;b>r&&b<s;b-=j)
			{
				if(l[a][b][y])
				{
					k[a][b]+=k[a+j][b];
				}
				if(l[a][b][z])
				{
					k[a][b]+=k[a][b+i];
				}
			}
		}
		printf("%lld\n",k[c][d]);
	}
	return 0;
}